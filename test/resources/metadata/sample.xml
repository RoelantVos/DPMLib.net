<?xml version="1.0" encoding="utf-16"?>
<ArrayOfMappedDataSet xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
  xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <MappedDataSet>
    <mappingName>m_200_HUB_POLICY_MIDAS_H_POLICY_PREMIUM</mappingName>
    <mappingDescription>HUB</mappingDescription>
    <enabled>true</enabled>
    <schemaExt>
      <AzP_EDW>
        <underlyingSource>
          <objectSchema>dbo</objectSchema>
          <objectName>HSTG_MIDAS_H_POLICY_PREMIUM</objectName>
        </underlyingSource>
      </AzP_EDW>
    </schemaExt>
    <source>
      <dataStore>
        <connectionKey>HSTG</connectionKey>
      </dataStore>
      <language>T-SQL</language>
      <code>declare @start_datetime datetime2 = ?,\n    @end_datetime datetime2 = ?;\n\nselect POLICY_SK,\n    OMD_INSERT_DATETIME,\n    OMD_RECORD_SOURCE,\n    POLICY_ID\nfrom    (\n        select convert(nvarchar(100), convert(nvarchar(100), intendedDataType.POLICY_ID) + N'_' + OMD_RECORD_SOURCE) as POLICY_SK, /* REM SK calcs to be pulled from TEAM metadata */\n            OMD_INSERT_DATETIME,\n            OMD_RECORD_SOURCE,\n            intendedDataType.POLICY_ID,\n            row_number() over (partition by intendedDataType.POLICY_ID\n                                order by OMD_INSERT_DATETIME asc\n                                ) as rn\n        from dbo.HSTG_MIDAS_H_POLICY_PREMIUM POLICY_PREMIUM\n            cross apply (\n                    select convert(bigint, POLICY_PREMIUM.POLICY_ID) as POLICY_ID\n                    ) as intendedDataType\n        where OMD_INSERT_DATETIME &gt;= @start_datetime\n            and OMD_INSERT_DATETIME &lt; @end_datetime\n        ) src\nwhere src.rn = 1\n    and not exists (\n        select null\n        from EDW_200_Integration_Layer.dbo.HUB_POLICY with (nolock)\n        where HUB_POLICY.POLICY_SK = src.POLICY_SK\n        );\n</code>
    </source>
    <target>
      <dataStore>
        <connectionKey>INT</connectionKey>
      </dataStore>
      <objectSchema>dbo</objectSchema>
      <objectName>HUB_POLICY</objectName>
    </target>
    <mappedDataItems>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>POLICY_SK</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>POLICY_SK</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>OMD_INSERT_DATETIME</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>OMD_FIRST_SEEN_DATETIME</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>OMD_INSERT_MODULE_INSTANCE_ID</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>OMD_INSERT_MODULE_INSTANCE_ID</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>OMD_RECORD_SOURCE</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>OMD_RECORD_SOURCE</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>POLICY_ID</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>POLICY_ID</columnName>
        </targetColumn>
      </MappedDataItem>
    </mappedDataItems>
  </MappedDataSet>
  <MappedDataSet>
    <mappingName>m_200_HUB_REF_STANDARD_CODE_MIDAS_MIDAS_STD_CODES_FN</mappingName>
    <mappingDescription>HUB</mappingDescription>
    <enabled>true</enabled>
    <schemaExt>
      <AzP_EDW>
        <underlyingSource>
          <objectSchema>dbo</objectSchema>
          <objectName>HSTG_MIDAS_STD_CODES_FN</objectName>
        </underlyingSource>
      </AzP_EDW>
    </schemaExt>
    <source>
      <dataStore>
        <connectionKey>HSTG</connectionKey>
      </dataStore>
      <language>T-SQL</language>
      <code>declare @start_datetime datetime2 = ?,\n    @end_datetime datetime2 = ?;\n\nselect REF_STANDARD_CODE_MIDAS_SK,\n    OMD_INSERT_DATETIME,\n    OMD_RECORD_SOURCE,\n    STANDARD_CODE_ID\nfrom    (\n        select convert(nvarchar(100), convert(nvarchar(100), intendedDataType.STANDARD_CODE_ID) + N'_' + OMD_RECORD_SOURCE) as REF_STANDARD_CODE_MIDAS_SK, /* REM SK calcs to be pulled from TEAM metadata */\n            OMD_INSERT_DATETIME,\n            OMD_RECORD_SOURCE,\n            intendedDataType.STANDARD_CODE_ID,\n            row_number() over (partition by intendedDataType.STANDARD_CODE_ID\n                                order by OMD_INSERT_DATETIME asc\n                                ) as rn\n        from dbo.HSTG_MIDAS_STD_CODES_FN(@start_datetime, @end_datetime) STD_CODES\n            cross apply (\n                    select convert(bigint, STD_CODES.STANDARD_CODE_ID) as STANDARD_CODE_ID\n                    ) as intendedDataType\n        ) src\nwhere src.rn = 1\n    and not exists (\n        select null\n        from EDW_200_Integration_Layer.dbo.HUB_REF_STANDARD_CODE_MIDAS with (nolock)\n        where HUB_REF_STANDARD_CODE_MIDAS.REF_STANDARD_CODE_MIDAS_SK = src.REF_STANDARD_CODE_MIDAS_SK\n        );\n</code>
    </source>
    <target>
      <dataStore>
        <connectionKey>INT</connectionKey>
      </dataStore>
      <objectSchema>dbo</objectSchema>
      <objectName>HUB_REF_STANDARD_CODE_MIDAS</objectName>
    </target>
    <mappedDataItems>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>REF_STANDARD_CODE_MIDAS_SK</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>REF_STANDARD_CODE_MIDAS_SK</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>OMD_INSERT_DATETIME</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>OMD_FIRST_SEEN_DATETIME</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>OMD_INSERT_MODULE_INSTANCE_ID</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>OMD_INSERT_MODULE_INSTANCE_ID</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>OMD_RECORD_SOURCE</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>OMD_RECORD_SOURCE</columnName>
        </targetColumn>
      </MappedDataItem>
      <MappedDataItem>
        <sourceDataItem>
          <columnName>STANDARD_CODE_ID</columnName>
        </sourceDataItem>
        <targetColumn>
          <columnName>STANDARD_CODE_ID</columnName>
        </targetColumn>
      </MappedDataItem>
    </mappedDataItems>
  </MappedDataSet>
</ArrayOfMappedDataSet>